package security.jwt

import kotlin.test.Test
import kotlin.test.assertEquals

class JWTTest {

    @Test
    fun decodeTest() {
        val token =
            "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ3c2dyYnpxYnFfaGt0QlJBNGRYOUYyOE5JSlBtZ012WWdHek84bThQRzlnIn0.eyJleHAiOjE3MTk0NzYzNTIsImlhdCI6MTcxOTQ3NDU1MiwiYXV0aF90aW1lIjoxNzE5NDc0NTUwLCJqdGkiOiJjYmI3NDg4ZS05NjVmLTRlYjktOTI5OS01OWE4OTE5MDJkOTIiLCJpc3MiOiJodHRwczovL2FwaS5pcGlmaWNhdGlvbi5jb20vYXV0aC9yZWFsbXMvaXBpZmljYXRpb24iLCJzdWIiOiI3MjJhOGRmZWEyMjZhMjk0OTNiNmM2ZjVmMmZmYjhmMDM0OTEzMzQ4NGZiMjNjYWU1NzI5OTJkYzdlNDQ1YmU1IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiNmJiZTZjNDAwY2NmNDA3MzllMDhlMGZmOWRkNjhkMzAiLCJzZXNzaW9uX3N0YXRlIjoiNDhiMDg2M2UtN2NmMy00ZTEwLTgzNDAtNTUwNTQzZmMxZGE1IiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIGlwOnBob25lX3ZlcmlmeSIsInNpZCI6IjQ4YjA4NjNlLTdjZjMtNGUxMC04MzQwLTU1MDU0M2ZjMWRhNSIsImxvZ2luX2hpbnQiOiI2MjgzMTk0OTI2MDc1IiwicGhvbmVfbnVtYmVyX3ZlcmlmaWVkIjoidHJ1ZSJ9.elgG0_AmtXJpFPgGw1Ak3WA2GtoUtt_NIN4L1ZnxUgzaxlaDrH29WueLHVu72XcPO8yWMxcQflmM1z143vUUT9yvUqXzK7upHE4Dh8OdIAAFvBe_coYJ4eCTtUWmmuIGbTQRFt_MRLEUAZ9WdIUtK1TZ3KxfDFBmZ2YY-fM1VGQLL6bzRo_uIO6hFKh37HRE4YGFXudkcDNYAheAz4C33m1JQaNdkH5CLe2U9e9wnfLUHJL3ZL5zXIBpC8QdB7FQ1EqWTymbnjTNl60zSbZtCHKP1LJHhyGNABplVa2D9lOSyGQccRXdOw2zQOOoCuAtw_xZE2EIRd1_RPgV5tNIFg"

        val jwt = JWT(token)
        val expected = mapOf(
            "alg" to "RS256",
            "typ" to "JWT",
            "kid" to "wsgrbzqbq_hktBRA4dX9F28NIJPmgMvYgGzO8m8PG9g"
        )
        assertEquals(expected, jwt.header)
    }

    @Test
    fun getSignature() {
        val token =
            "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ3c2dyYnpxYnFfaGt0QlJBNGRYOUYyOE5JSlBtZ012WWdHek84bThQRzlnIn0.eyJleHAiOjE3MTk0NzYzNTIsImlhdCI6MTcxOTQ3NDU1MiwiYXV0aF90aW1lIjoxNzE5NDc0NTUwLCJqdGkiOiJjYmI3NDg4ZS05NjVmLTRlYjktOTI5OS01OWE4OTE5MDJkOTIiLCJpc3MiOiJodHRwczovL2FwaS5pcGlmaWNhdGlvbi5jb20vYXV0aC9yZWFsbXMvaXBpZmljYXRpb24iLCJzdWIiOiI3MjJhOGRmZWEyMjZhMjk0OTNiNmM2ZjVmMmZmYjhmMDM0OTEzMzQ4NGZiMjNjYWU1NzI5OTJkYzdlNDQ1YmU1IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiNmJiZTZjNDAwY2NmNDA3MzllMDhlMGZmOWRkNjhkMzAiLCJzZXNzaW9uX3N0YXRlIjoiNDhiMDg2M2UtN2NmMy00ZTEwLTgzNDAtNTUwNTQzZmMxZGE1IiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIGlwOnBob25lX3ZlcmlmeSIsInNpZCI6IjQ4YjA4NjNlLTdjZjMtNGUxMC04MzQwLTU1MDU0M2ZjMWRhNSIsImxvZ2luX2hpbnQiOiI2MjgzMTk0OTI2MDc1IiwicGhvbmVfbnVtYmVyX3ZlcmlmaWVkIjoidHJ1ZSJ9.elgG0_AmtXJpFPgGw1Ak3WA2GtoUtt_NIN4L1ZnxUgzaxlaDrH29WueLHVu72XcPO8yWMxcQflmM1z143vUUT9yvUqXzK7upHE4Dh8OdIAAFvBe_coYJ4eCTtUWmmuIGbTQRFt_MRLEUAZ9WdIUtK1TZ3KxfDFBmZ2YY-fM1VGQLL6bzRo_uIO6hFKh37HRE4YGFXudkcDNYAheAz4C33m1JQaNdkH5CLe2U9e9wnfLUHJL3ZL5zXIBpC8QdB7FQ1EqWTymbnjTNl60zSbZtCHKP1LJHhyGNABplVa2D9lOSyGQccRXdOw2zQOOoCuAtw_xZE2EIRd1_RPgV5tNIFg"
        val jwt = JWT(token)
        val signature =
            "elgG0_AmtXJpFPgGw1Ak3WA2GtoUtt_NIN4L1ZnxUgzaxlaDrH29WueLHVu72XcPO8yWMxcQflmM1z143vUUT9yvUqXzK7upHE4Dh8OdIAAFvBe_coYJ4eCTtUWmmuIGbTQRFt_MRLEUAZ9WdIUtK1TZ3KxfDFBmZ2YY-fM1VGQLL6bzRo_uIO6hFKh37HRE4YGFXudkcDNYAheAz4C33m1JQaNdkH5CLe2U9e9wnfLUHJL3ZL5zXIBpC8QdB7FQ1EqWTymbnjTNl60zSbZtCHKP1LJHhyGNABplVa2D9lOSyGQccRXdOw2zQOOoCuAtw_xZE2EIRd1_RPgV5tNIFg"
        assertEquals(signature, jwt.signature)
    }

    @Test
    fun getClaim() {
        val token =
            "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ3c2dyYnpxYnFfaGt0QlJBNGRYOUYyOE5JSlBtZ012WWdHek84bThQRzlnIn0.eyJleHAiOjE3MTk0NzYzNTIsImlhdCI6MTcxOTQ3NDU1MiwiYXV0aF90aW1lIjoxNzE5NDc0NTUwLCJqdGkiOiJjYmI3NDg4ZS05NjVmLTRlYjktOTI5OS01OWE4OTE5MDJkOTIiLCJpc3MiOiJodHRwczovL2FwaS5pcGlmaWNhdGlvbi5jb20vYXV0aC9yZWFsbXMvaXBpZmljYXRpb24iLCJzdWIiOiI3MjJhOGRmZWEyMjZhMjk0OTNiNmM2ZjVmMmZmYjhmMDM0OTEzMzQ4NGZiMjNjYWU1NzI5OTJkYzdlNDQ1YmU1IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiNmJiZTZjNDAwY2NmNDA3MzllMDhlMGZmOWRkNjhkMzAiLCJzZXNzaW9uX3N0YXRlIjoiNDhiMDg2M2UtN2NmMy00ZTEwLTgzNDAtNTUwNTQzZmMxZGE1IiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIGlwOnBob25lX3ZlcmlmeSIsInNpZCI6IjQ4YjA4NjNlLTdjZjMtNGUxMC04MzQwLTU1MDU0M2ZjMWRhNSIsImxvZ2luX2hpbnQiOiI2MjgzMTk0OTI2MDc1IiwicGhvbmVfbnVtYmVyX3ZlcmlmaWVkIjoidHJ1ZSJ9.elgG0_AmtXJpFPgGw1Ak3WA2GtoUtt_NIN4L1ZnxUgzaxlaDrH29WueLHVu72XcPO8yWMxcQflmM1z143vUUT9yvUqXzK7upHE4Dh8OdIAAFvBe_coYJ4eCTtUWmmuIGbTQRFt_MRLEUAZ9WdIUtK1TZ3KxfDFBmZ2YY-fM1VGQLL6bzRo_uIO6hFKh37HRE4YGFXudkcDNYAheAz4C33m1JQaNdkH5CLe2U9e9wnfLUHJL3ZL5zXIBpC8QdB7FQ1EqWTymbnjTNl60zSbZtCHKP1LJHhyGNABplVa2D9lOSyGQccRXdOw2zQOOoCuAtw_xZE2EIRd1_RPgV5tNIFg"
        val jwt = JWT(token)
        val loginHint = jwt.getClaim("login_hint")?.asLong()
        println("login_hint : $loginHint")
    }

}